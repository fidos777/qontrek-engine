{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://qontrek.io/schemas/widgets/alert-widget.json",
  "title": "Alert Widget Schema",
  "description": "Notifications and warnings display for ChatGPT Apps",
  "type": "object",
  "required": ["type", "schemaVersion", "title", "alerts"],
  "properties": {
    "type": {
      "const": "alert_widget",
      "description": "Widget type identifier"
    },
    "schemaVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "title": {
      "type": "string",
      "description": "Widget title"
    },
    "subtitle": {
      "type": "string"
    },
    "alerts": {
      "oneOf": [
        { "type": "string" },
        { "$ref": "#/$defs/dataBinding" },
        {
          "type": "array",
          "items": { "$ref": "#/$defs/alertItem" }
        }
      ],
      "description": "Alert items path or inline array"
    },
    "maxVisible": {
      "type": "integer",
      "minimum": 1,
      "default": 5,
      "description": "Maximum alerts to display"
    },
    "groupBySeverity": {
      "type": "boolean",
      "default": false,
      "description": "Group alerts by severity level"
    },
    "sortBy": {
      "type": "string",
      "enum": ["timestamp", "severity"],
      "default": "timestamp",
      "description": "Sort field"
    },
    "sortOrder": {
      "type": "string",
      "enum": ["asc", "desc"],
      "default": "desc",
      "description": "Sort order"
    },
    "showFilter": {
      "type": "boolean",
      "default": false,
      "description": "Show severity filter"
    },
    "sound": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "critical": { "type": "string", "description": "Sound file for critical alerts" },
        "high": { "type": "string", "description": "Sound file for high alerts" }
      },
      "description": "Notification sound configuration"
    },
    "bulkActions": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetAction" },
      "description": "Bulk actions for multiple alerts"
    },
    "fields": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetField" }
    },
    "actions": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetAction" }
    },
    "conditions": { "$ref": "#/$defs/condition" },
    "styling": { "$ref": "#/$defs/styleHints" },
    "responsive": { "$ref": "#/$defs/responsiveHints" },
    "accessibility": { "$ref": "#/$defs/accessibilityHints" }
  },
  "$defs": {
    "alertItem": {
      "type": "object",
      "required": ["id", "severity", "title", "message"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique alert identifier"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low", "info"],
          "description": "Alert severity level"
        },
        "title": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Alert title"
        },
        "message": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Alert message"
        },
        "timestamp": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Alert timestamp"
        },
        "source": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Source system"
        },
        "entity": {
          "type": "object",
          "properties": {
            "type": { "type": "string" },
            "id": {
              "oneOf": [
                { "type": "string" },
                { "$ref": "#/$defs/dataBinding" }
              ]
            },
            "name": {
              "oneOf": [
                { "type": "string" },
                { "$ref": "#/$defs/dataBinding" }
              ]
            }
          },
          "description": "Related entity"
        },
        "actions": {
          "type": "array",
          "items": { "$ref": "#/$defs/widgetAction" }
        },
        "dismissible": {
          "type": "boolean",
          "default": true
        },
        "autoDismiss": {
          "type": "integer",
          "minimum": 0,
          "description": "Auto-dismiss after milliseconds"
        }
      }
    },
    "dataBinding": {
      "type": "object",
      "required": ["path"],
      "properties": {
        "path": { "type": "string" },
        "fallback": { "oneOf": [{ "type": "string" }, { "type": "number" }, { "type": "boolean" }] },
        "transform": { "type": "string", "enum": ["uppercase", "lowercase", "capitalize", "truncate", "format_currency", "format_date", "format_number"] }
      }
    },
    "fieldFormat": {
      "type": "string",
      "enum": ["text", "number", "currency", "percentage", "date", "datetime", "email", "phone", "url", "badge", "progress", "trend", "avatar", "icon", "color", "json", "markdown", "html", "file", "image", "signature", "hash"]
    },
    "widgetField": {
      "type": "object",
      "required": ["id", "label", "binding", "format"],
      "properties": {
        "id": { "type": "string" },
        "label": { "type": "string" },
        "binding": { "oneOf": [{ "type": "string" }, { "$ref": "#/$defs/dataBinding" }] },
        "format": { "$ref": "#/$defs/fieldFormat" },
        "conditions": { "$ref": "#/$defs/condition" },
        "accessibility": { "$ref": "#/$defs/accessibilityHints" },
        "responsive": { "$ref": "#/$defs/responsiveHints" },
        "styling": { "$ref": "#/$defs/styleHints" }
      }
    },
    "widgetAction": {
      "type": "object",
      "required": ["id", "label", "type", "handler"],
      "properties": {
        "id": { "type": "string" },
        "label": { "type": "string" },
        "type": { "type": "string", "enum": ["primary", "secondary", "danger", "success", "warning", "ghost", "link"] },
        "icon": { "type": "string" },
        "handler": { "type": "string" },
        "params": { "type": "object" },
        "confirm": { "type": "object" },
        "conditions": { "$ref": "#/$defs/condition" },
        "accessibility": { "$ref": "#/$defs/accessibilityHints" },
        "styling": { "$ref": "#/$defs/styleHints" }
      }
    },
    "conditionRule": {
      "type": "object",
      "required": ["field", "operator"],
      "properties": {
        "field": { "type": "string" },
        "operator": { "type": "string", "enum": ["eq", "neq", "gt", "gte", "lt", "lte", "contains", "not_contains", "in", "not_in", "exists", "not_exists", "matches"] },
        "value": {},
        "logic": { "type": "string", "enum": ["and", "or"] }
      }
    },
    "condition": {
      "type": "object",
      "properties": {
        "show": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "hide": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "enable": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "disable": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } }
      }
    },
    "accessibilityHints": {
      "type": "object",
      "properties": {
        "ariaLabel": { "type": "string" },
        "ariaDescription": { "type": "string" },
        "role": { "type": "string" },
        "tabIndex": { "type": "integer" },
        "shortcut": { "type": "string" },
        "ariaLive": { "type": "string", "enum": ["polite", "assertive", "off"] }
      }
    },
    "responsiveHints": {
      "type": "object",
      "properties": {
        "hideOn": { "type": "array", "items": { "type": "string" } },
        "showOn": { "type": "array", "items": { "type": "string" } },
        "columns": { "type": "object" },
        "stack": { "type": "object" }
      }
    },
    "styleHints": {
      "type": "object",
      "properties": {
        "urgency": { "type": "string", "enum": ["critical", "high", "medium", "low", "info"] },
        "variant": { "type": "string", "enum": ["default", "outlined", "filled", "ghost"] },
        "size": { "type": "string", "enum": ["xs", "sm", "md", "lg", "xl"] },
        "className": { "type": "string" },
        "style": { "type": "object" },
        "animation": { "type": "string", "enum": ["none", "fade", "slide", "scale", "pulse"] }
      }
    }
  },
  "examples": [
    {
      "type": "alert_widget",
      "schemaVersion": "1.0.0",
      "title": "System Alerts",
      "alerts": "{{alerts.active}}",
      "maxVisible": 10,
      "groupBySeverity": true,
      "sortBy": "severity",
      "sortOrder": "desc",
      "showFilter": true,
      "sound": {
        "enabled": true,
        "critical": "/sounds/critical.mp3",
        "high": "/sounds/high.mp3"
      },
      "bulkActions": [
        { "id": "dismissAll", "label": "Dismiss All", "type": "ghost", "icon": "x", "handler": "dismissAllAlerts" },
        { "id": "markRead", "label": "Mark All Read", "type": "ghost", "icon": "check", "handler": "markAllRead" }
      ],
      "accessibility": {
        "ariaLabel": "System alerts - {{alerts.critical.length}} critical, {{alerts.high.length}} high priority",
        "ariaLive": "assertive",
        "role": "alert"
      }
    },
    {
      "type": "alert_widget",
      "schemaVersion": "1.0.0",
      "title": "Payment Alerts",
      "alerts": [
        {
          "id": "payment_1",
          "severity": "critical",
          "title": "Payment Failed",
          "message": "{{alert.customer}} - Payment of {{alert.amount}} failed after 3 retries",
          "timestamp": "{{alert.timestamp}}",
          "source": "Payment Gateway",
          "entity": {
            "type": "customer",
            "id": "{{alert.customerId}}",
            "name": "{{alert.customer}}"
          },
          "actions": [
            { "id": "retry", "label": "Retry", "type": "primary", "icon": "refresh-cw", "handler": "retryPayment" },
            { "id": "contact", "label": "Contact Customer", "type": "secondary", "icon": "phone", "handler": "contactCustomer" }
          ],
          "dismissible": true
        },
        {
          "id": "payment_2",
          "severity": "high",
          "title": "Large Transaction",
          "message": "Unusual transaction of $50,000 detected for review",
          "timestamp": "2024-01-15T10:30:00Z",
          "source": "Fraud Detection",
          "actions": [
            { "id": "approve", "label": "Approve", "type": "success", "icon": "check", "handler": "approveTransaction" },
            { "id": "reject", "label": "Reject", "type": "danger", "icon": "x", "handler": "rejectTransaction" }
          ]
        }
      ]
    }
  ]
}
