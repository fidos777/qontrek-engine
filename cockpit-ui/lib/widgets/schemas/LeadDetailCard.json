{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://qontrek.io/schemas/widgets/lead-detail-card.json",
  "title": "Lead Detail Card Widget Schema",
  "description": "Displays full lead information with collapsible sections and actions for ChatGPT Apps",
  "type": "object",
  "required": ["type", "schemaVersion", "title", "header", "sections"],
  "properties": {
    "type": {
      "const": "lead_detail_card",
      "description": "Widget type identifier"
    },
    "schemaVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "title": {
      "type": "string",
      "description": "Widget title with template support"
    },
    "subtitle": {
      "type": "string"
    },
    "header": {
      "type": "object",
      "required": ["name", "status"],
      "properties": {
        "avatar": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Avatar image URL or initials path"
        },
        "name": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Lead name (e.g., '{{lead.name}}')"
        },
        "subtitle": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Lead subtitle (e.g., company, title)"
        },
        "status": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Lead status field"
        },
        "statusColorMap": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "Map status values to colors",
          "examples": [
            {
              "qualified": "green",
              "nurturing": "blue",
              "cold": "gray",
              "lost": "red"
            }
          ]
        }
      }
    },
    "sections": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "title", "fields"],
        "properties": {
          "id": { "type": "string" },
          "title": { "type": "string" },
          "collapsed": {
            "type": "boolean",
            "default": false,
            "description": "Section initially collapsed"
          },
          "fields": {
            "type": "array",
            "items": { "$ref": "#/$defs/widgetField" }
          },
          "conditions": { "$ref": "#/$defs/condition" }
        }
      },
      "description": "Collapsible detail sections"
    },
    "quickActions": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetAction" },
      "description": "Quick action bar buttons"
    },
    "timeline": {
      "oneOf": [
        { "type": "string" },
        { "$ref": "#/$defs/dataBinding" }
      ],
      "description": "Path to activity timeline data"
    },
    "relatedLeads": {
      "oneOf": [
        { "type": "string" },
        { "$ref": "#/$defs/dataBinding" }
      ],
      "description": "Path to related leads data"
    },
    "fields": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetField" }
    },
    "actions": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetAction" }
    },
    "conditions": { "$ref": "#/$defs/condition" },
    "styling": { "$ref": "#/$defs/styleHints" },
    "responsive": { "$ref": "#/$defs/responsiveHints" },
    "accessibility": { "$ref": "#/$defs/accessibilityHints" }
  },
  "$defs": {
    "dataBinding": {
      "type": "object",
      "required": ["path"],
      "properties": {
        "path": { "type": "string" },
        "fallback": {
          "oneOf": [
            { "type": "string" },
            { "type": "number" },
            { "type": "boolean" }
          ]
        },
        "transform": {
          "type": "string",
          "enum": ["uppercase", "lowercase", "capitalize", "truncate", "format_currency", "format_date", "format_number"]
        }
      }
    },
    "fieldFormat": {
      "type": "string",
      "enum": [
        "text", "number", "currency", "percentage", "date", "datetime",
        "email", "phone", "url", "badge", "progress", "trend",
        "avatar", "icon", "color", "json", "markdown", "html",
        "file", "image", "signature", "hash"
      ]
    },
    "widgetField": {
      "type": "object",
      "required": ["id", "label", "binding", "format"],
      "properties": {
        "id": { "type": "string" },
        "label": { "type": "string" },
        "binding": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ]
        },
        "format": { "$ref": "#/$defs/fieldFormat" },
        "maxLength": { "type": "integer" },
        "copyable": { "type": "boolean" },
        "conditions": { "$ref": "#/$defs/condition" },
        "accessibility": { "$ref": "#/$defs/accessibilityHints" },
        "responsive": { "$ref": "#/$defs/responsiveHints" },
        "styling": { "$ref": "#/$defs/styleHints" }
      }
    },
    "widgetAction": {
      "type": "object",
      "required": ["id", "label", "type", "handler"],
      "properties": {
        "id": { "type": "string" },
        "label": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["primary", "secondary", "danger", "success", "warning", "ghost", "link"]
        },
        "icon": { "type": "string" },
        "handler": { "type": "string" },
        "params": { "type": "object" },
        "confirm": {
          "type": "object",
          "properties": {
            "title": { "type": "string" },
            "message": { "type": "string" },
            "confirmLabel": { "type": "string" },
            "cancelLabel": { "type": "string" }
          }
        },
        "conditions": { "$ref": "#/$defs/condition" },
        "accessibility": { "$ref": "#/$defs/accessibilityHints" },
        "styling": { "$ref": "#/$defs/styleHints" }
      }
    },
    "conditionRule": {
      "type": "object",
      "required": ["field", "operator"],
      "properties": {
        "field": { "type": "string" },
        "operator": {
          "type": "string",
          "enum": ["eq", "neq", "gt", "gte", "lt", "lte", "contains", "not_contains", "in", "not_in", "exists", "not_exists", "matches"]
        },
        "value": {},
        "logic": { "type": "string", "enum": ["and", "or"] }
      }
    },
    "condition": {
      "type": "object",
      "properties": {
        "show": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "hide": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "enable": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "disable": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } }
      }
    },
    "accessibilityHints": {
      "type": "object",
      "properties": {
        "ariaLabel": { "type": "string" },
        "ariaDescription": { "type": "string" },
        "role": { "type": "string" },
        "tabIndex": { "type": "integer" },
        "shortcut": { "type": "string" },
        "ariaLive": { "type": "string", "enum": ["polite", "assertive", "off"] }
      }
    },
    "responsiveHints": {
      "type": "object",
      "properties": {
        "hideOn": { "type": "array", "items": { "type": "string", "enum": ["mobile", "tablet", "desktop", "wide"] } },
        "showOn": { "type": "array", "items": { "type": "string", "enum": ["mobile", "tablet", "desktop", "wide"] } },
        "columns": { "type": "object" },
        "stack": { "type": "object" }
      }
    },
    "styleHints": {
      "type": "object",
      "properties": {
        "urgency": { "type": "string", "enum": ["critical", "high", "medium", "low", "info"] },
        "variant": { "type": "string", "enum": ["default", "outlined", "filled", "ghost"] },
        "size": { "type": "string", "enum": ["xs", "sm", "md", "lg", "xl"] },
        "className": { "type": "string" },
        "style": { "type": "object" },
        "animation": { "type": "string", "enum": ["none", "fade", "slide", "scale", "pulse"] }
      }
    }
  },
  "examples": [
    {
      "type": "lead_detail_card",
      "schemaVersion": "1.0.0",
      "title": "Lead Details",
      "header": {
        "avatar": "{{lead.avatar}}",
        "name": "{{lead.name}}",
        "subtitle": "{{lead.company}} - {{lead.title}}",
        "status": "{{lead.status}}",
        "statusColorMap": {
          "qualified": "green",
          "nurturing": "blue",
          "cold": "gray"
        }
      },
      "sections": [
        {
          "id": "contact",
          "title": "Contact Information",
          "fields": [
            { "id": "email", "label": "Email", "binding": "{{lead.email}}", "format": "email", "copyable": true },
            { "id": "phone", "label": "Phone", "binding": "{{lead.phone}}", "format": "phone" },
            { "id": "company", "label": "Company", "binding": "{{lead.company}}", "format": "text" }
          ]
        },
        {
          "id": "opportunity",
          "title": "Opportunity Details",
          "collapsed": true,
          "fields": [
            { "id": "value", "label": "Deal Value", "binding": "{{lead.dealValue}}", "format": "currency" },
            { "id": "probability", "label": "Win Probability", "binding": "{{lead.probability}}", "format": "percentage" },
            { "id": "closeDate", "label": "Expected Close", "binding": "{{lead.closeDate}}", "format": "date" }
          ]
        }
      ],
      "quickActions": [
        { "id": "call", "label": "Call", "type": "primary", "icon": "phone", "handler": "initiateCall", "params": { "phone": "{{lead.phone}}" } },
        { "id": "email", "label": "Email", "type": "secondary", "icon": "mail", "handler": "composeEmail", "params": { "to": "{{lead.email}}" } },
        { "id": "schedule", "label": "Schedule", "type": "ghost", "icon": "calendar", "handler": "scheduleMeeting" }
      ],
      "accessibility": {
        "ariaLabel": "Lead details for {{lead.name}}",
        "role": "article"
      }
    }
  ]
}
