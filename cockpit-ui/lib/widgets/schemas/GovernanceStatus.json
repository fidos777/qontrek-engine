{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://qontrek.io/schemas/widgets/governance-status.json",
  "title": "Governance Status Widget Schema",
  "description": "Displays G13-G21 gate statuses with compliance scoring for ChatGPT Apps",
  "type": "object",
  "required": ["type", "schemaVersion", "title", "gates", "layout"],
  "properties": {
    "type": {
      "const": "governance_status",
      "description": "Widget type identifier"
    },
    "schemaVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "title": {
      "type": "string",
      "description": "Widget title"
    },
    "subtitle": {
      "type": "string"
    },
    "overallScore": {
      "type": "object",
      "properties": {
        "value": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ],
          "description": "Overall compliance score"
        },
        "threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "default": 80,
          "description": "Passing threshold"
        }
      },
      "description": "Overall compliance score display"
    },
    "gates": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "gateId", "name", "status"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique gate identifier"
          },
          "gateId": {
            "type": "string",
            "pattern": "^G[0-9]{1,2}$",
            "description": "Gate ID (e.g., G13, G21)"
          },
          "name": {
            "type": "string",
            "description": "Gate display name"
          },
          "status": {
            "oneOf": [
              { "type": "string" },
              { "$ref": "#/$defs/dataBinding" }
            ],
            "description": "Gate status path"
          },
          "statusColorMap": {
            "type": "object",
            "additionalProperties": { "type": "string" },
            "default": {
              "passed": "green",
              "pending": "yellow",
              "failed": "red",
              "not_started": "gray"
            }
          },
          "progress": {
            "oneOf": [
              { "type": "string" },
              { "$ref": "#/$defs/dataBinding" }
            ],
            "description": "Completion percentage"
          },
          "lastUpdated": {
            "oneOf": [
              { "type": "string" },
              { "$ref": "#/$defs/dataBinding" }
            ],
            "description": "Last updated timestamp"
          },
          "owner": {
            "oneOf": [
              { "type": "string" },
              { "$ref": "#/$defs/dataBinding" }
            ],
            "description": "Responsible party"
          },
          "actions": {
            "type": "array",
            "items": { "$ref": "#/$defs/widgetAction" }
          },
          "checks": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "name", "status"],
              "properties": {
                "id": { "type": "string" },
                "name": { "type": "string" },
                "status": {
                  "oneOf": [
                    { "type": "string" },
                    { "$ref": "#/$defs/dataBinding" }
                  ]
                },
                "message": {
                  "oneOf": [
                    { "type": "string" },
                    { "$ref": "#/$defs/dataBinding" }
                  ]
                }
              }
            },
            "description": "Sub-checks within gate"
          }
        }
      },
      "description": "Gate status configurations"
    },
    "layout": {
      "type": "string",
      "enum": ["list", "grid", "timeline"],
      "default": "list",
      "description": "Gate display layout"
    },
    "showProgress": {
      "type": "boolean",
      "default": true,
      "description": "Show progress bar"
    },
    "certification": {
      "type": "object",
      "properties": {
        "status": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ]
        },
        "certId": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ]
        },
        "validUntil": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/$defs/dataBinding" }
          ]
        }
      },
      "description": "Certification status"
    },
    "fields": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetField" }
    },
    "actions": {
      "type": "array",
      "items": { "$ref": "#/$defs/widgetAction" }
    },
    "conditions": { "$ref": "#/$defs/condition" },
    "styling": { "$ref": "#/$defs/styleHints" },
    "responsive": { "$ref": "#/$defs/responsiveHints" },
    "accessibility": { "$ref": "#/$defs/accessibilityHints" }
  },
  "$defs": {
    "dataBinding": {
      "type": "object",
      "required": ["path"],
      "properties": {
        "path": { "type": "string" },
        "fallback": { "oneOf": [{ "type": "string" }, { "type": "number" }, { "type": "boolean" }] },
        "transform": { "type": "string", "enum": ["uppercase", "lowercase", "capitalize", "truncate", "format_currency", "format_date", "format_number"] }
      }
    },
    "fieldFormat": {
      "type": "string",
      "enum": ["text", "number", "currency", "percentage", "date", "datetime", "email", "phone", "url", "badge", "progress", "trend", "avatar", "icon", "color", "json", "markdown", "html", "file", "image", "signature", "hash"]
    },
    "widgetField": {
      "type": "object",
      "required": ["id", "label", "binding", "format"],
      "properties": {
        "id": { "type": "string" },
        "label": { "type": "string" },
        "binding": { "oneOf": [{ "type": "string" }, { "$ref": "#/$defs/dataBinding" }] },
        "format": { "$ref": "#/$defs/fieldFormat" },
        "conditions": { "$ref": "#/$defs/condition" },
        "accessibility": { "$ref": "#/$defs/accessibilityHints" },
        "responsive": { "$ref": "#/$defs/responsiveHints" },
        "styling": { "$ref": "#/$defs/styleHints" }
      }
    },
    "widgetAction": {
      "type": "object",
      "required": ["id", "label", "type", "handler"],
      "properties": {
        "id": { "type": "string" },
        "label": { "type": "string" },
        "type": { "type": "string", "enum": ["primary", "secondary", "danger", "success", "warning", "ghost", "link"] },
        "icon": { "type": "string" },
        "handler": { "type": "string" },
        "params": { "type": "object" },
        "confirm": { "type": "object" },
        "conditions": { "$ref": "#/$defs/condition" },
        "accessibility": { "$ref": "#/$defs/accessibilityHints" },
        "styling": { "$ref": "#/$defs/styleHints" }
      }
    },
    "conditionRule": {
      "type": "object",
      "required": ["field", "operator"],
      "properties": {
        "field": { "type": "string" },
        "operator": { "type": "string", "enum": ["eq", "neq", "gt", "gte", "lt", "lte", "contains", "not_contains", "in", "not_in", "exists", "not_exists", "matches"] },
        "value": {},
        "logic": { "type": "string", "enum": ["and", "or"] }
      }
    },
    "condition": {
      "type": "object",
      "properties": {
        "show": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "hide": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "enable": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } },
        "disable": { "type": "array", "items": { "$ref": "#/$defs/conditionRule" } }
      }
    },
    "accessibilityHints": {
      "type": "object",
      "properties": {
        "ariaLabel": { "type": "string" },
        "ariaDescription": { "type": "string" },
        "role": { "type": "string" },
        "tabIndex": { "type": "integer" },
        "shortcut": { "type": "string" },
        "ariaLive": { "type": "string", "enum": ["polite", "assertive", "off"] }
      }
    },
    "responsiveHints": {
      "type": "object",
      "properties": {
        "hideOn": { "type": "array", "items": { "type": "string" } },
        "showOn": { "type": "array", "items": { "type": "string" } },
        "columns": { "type": "object" },
        "stack": { "type": "object" }
      }
    },
    "styleHints": {
      "type": "object",
      "properties": {
        "urgency": { "type": "string", "enum": ["critical", "high", "medium", "low", "info"] },
        "variant": { "type": "string", "enum": ["default", "outlined", "filled", "ghost"] },
        "size": { "type": "string", "enum": ["xs", "sm", "md", "lg", "xl"] },
        "className": { "type": "string" },
        "style": { "type": "object" },
        "animation": { "type": "string", "enum": ["none", "fade", "slide", "scale", "pulse"] }
      }
    }
  },
  "examples": [
    {
      "type": "governance_status",
      "schemaVersion": "1.0.0",
      "title": "Governance Compliance",
      "overallScore": {
        "value": "{{governance.overallScore}}",
        "threshold": 85
      },
      "layout": "list",
      "showProgress": true,
      "gates": [
        {
          "id": "g13",
          "gateId": "G13",
          "name": "Data Privacy Compliance",
          "status": "{{governance.gates.g13.status}}",
          "progress": "{{governance.gates.g13.progress}}",
          "lastUpdated": "{{governance.gates.g13.lastUpdated}}",
          "owner": "{{governance.gates.g13.owner}}",
          "checks": [
            { "id": "gdpr", "name": "GDPR Compliance", "status": "{{governance.gates.g13.checks.gdpr}}" },
            { "id": "ccpa", "name": "CCPA Compliance", "status": "{{governance.gates.g13.checks.ccpa}}" },
            { "id": "encryption", "name": "Data Encryption", "status": "{{governance.gates.g13.checks.encryption}}" }
          ],
          "actions": [
            { "id": "review", "label": "Review", "type": "ghost", "icon": "eye", "handler": "reviewGate" }
          ]
        },
        {
          "id": "g14",
          "gateId": "G14",
          "name": "Access Control",
          "status": "{{governance.gates.g14.status}}",
          "progress": "{{governance.gates.g14.progress}}",
          "lastUpdated": "{{governance.gates.g14.lastUpdated}}"
        },
        {
          "id": "g15",
          "gateId": "G15",
          "name": "Audit Logging",
          "status": "{{governance.gates.g15.status}}",
          "progress": "{{governance.gates.g15.progress}}"
        },
        {
          "id": "g21",
          "gateId": "G21",
          "name": "Incident Response",
          "status": "{{governance.gates.g21.status}}",
          "progress": "{{governance.gates.g21.progress}}"
        }
      ],
      "certification": {
        "status": "{{governance.certification.status}}",
        "certId": "{{governance.certification.id}}",
        "validUntil": "{{governance.certification.validUntil}}"
      },
      "actions": [
        { "id": "export", "label": "Export Report", "type": "secondary", "icon": "download", "handler": "exportGovernanceReport" },
        { "id": "recertify", "label": "Request Re-certification", "type": "primary", "icon": "shield", "handler": "requestRecertification" }
      ],
      "accessibility": {
        "ariaLabel": "Governance compliance status showing {{governance.overallScore}}% overall compliance",
        "ariaLive": "polite"
      }
    }
  ]
}
